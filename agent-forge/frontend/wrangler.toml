# CLOUDFLARE PAGES CONFIGURATION  
# The Deployment Manifest of the Undying Lands

name = "agent-forge-frontend"
compatibility_date = "2023-12-01"

[env.production]
name = "agent-forge-frontend"
routes = [
  { pattern = "agent.forge/*", zone_name = "agent.forge" },
  { pattern = "www.agent.forge/*", zone_name = "agent.forge" }
]

# Custom domains
[[env.production.custom_domains]]
domain = "agent.forge"

[[env.production.custom_domains]]  
domain = "www.agent.forge"

[env.staging]
name = "agent-forge-staging"

# Build configuration
[build]
command = "echo 'No build needed - static files'"
publish = "frontend/"

# Environment variables for frontend
[vars]
API_BASE_URL = "https://api.agent.forge"
WIDGET_CDN_URL = "https://cdn.agent.forge"
ENVIRONMENT = "production"

# Custom headers for security
[[headers]]
for = "/*"
[headers.values]
X-Frame-Options = "DENY"
X-Content-Type-Options = "nosniff"
X-XSS-Protection = "1; mode=block"
Referrer-Policy = "strict-origin-when-cross-origin"
Content-Security-Policy = "default-src 'self'; script-src 'self' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; img-src 'self' data: https:; font-src 'self' https:; connect-src 'self' https:"

# Cache static assets
[[headers]]
for = "*.js"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
for = "*.css"
[headers.values]  
Cache-Control = "public, max-age=31536000, immutable"

# Widget special handling
[[headers]]
for = "/widget.js"
[headers.values]
Cache-Control = "public, max-age=3600"
Access-Control-Allow-Origin = "*"
Access-Control-Allow-Methods = "GET"

# Redirects
[[redirects]]
from = "/dashboard/*"
to = "/index.html"
status = 200

[[redirects]]
from = "/clients/*"
to = "/index.html" 
status = 200

# Health check endpoint
[[headers]]
for = "/health"
[headers.values]
Cache-Control = "no-cache"